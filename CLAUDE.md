# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a **photographer portfolio website with an integrated e-shop** built with Laravel 12, Inertia.js, Vue 3, and Tailwind CSS. The application allows photographers to showcase their work in organized albums while selling prints, digital downloads, and other photography-related products.

### Tech Stack

- **Backend**: Laravel 12 (PHP framework)
- **Frontend**: Vue 3 with Inertia.js (SPA-like experience without API)
- **Styling**: Tailwind CSS
- **Authentication**: Laravel Breeze with Inertia stack
- **Database**: SQLite (default, can be changed to MySQL/PostgreSQL)
- **Build Tool**: Vite
- **Routing**: Ziggy (Laravel routes in JavaScript)

## Architecture

### Laravel + Inertia + Vue Flow

This application uses Inertia.js to connect Laravel and Vue:
- **Laravel controllers** return Inertia responses instead of views/JSON
- **Vue components** receive data as props from Laravel
- **No separate API needed** - Inertia acts as the adapter layer
- **Routing** is handled by Laravel, with Ziggy providing route helpers in JavaScript

### Directory Structure

```
app/
├── Http/
│   ├── Controllers/          # Laravel controllers (return Inertia responses)
│   └── Middleware/           # Request middleware
├── Models/                   # Eloquent models (Album, Photo, Product, Order, etc.)
└── Providers/                # Service providers

database/
├── migrations/               # Database schema migrations
└── factories/                # Model factories for testing

resources/
├── js/
│   ├── Components/           # Reusable Vue components
│   ├── Layouts/              # Vue layout components (Authenticated, Guest)
│   ├── Pages/                # Full-page Vue components (mapped to routes)
│   └── app.js                # Vue app entry point
└── css/
    └── app.css               # Tailwind CSS

routes/
├── web.php                   # Application routes
└── auth.php                  # Authentication routes (from Breeze)

public/
└── build/                    # Compiled assets (generated by Vite)
```

## Database Schema

### Core Tables

#### albums
Organizes photos into categories/collections
- `id`: Primary key
- `title`: Album name
- `description`: Album description (nullable)
- `slug`: URL-friendly identifier (unique)
- `cover_image`: Path to album cover (nullable)
- `display_order`: Sort order for display
- `is_published`: Visibility toggle
- `created_at`, `updated_at`: Timestamps

#### photos
Individual photographs in albums
- `id`: Primary key
- `album_id`: Foreign key to albums (cascades on delete)
- `title`: Photo title
- `description`: Photo description (nullable)
- `image_path`: Full-size image path
- `thumbnail_path`: Thumbnail image path (nullable)
- `medium_path`: Medium-size image path (nullable)
- `width`, `height`: Image dimensions (nullable)
- `file_size`: File size in bytes (nullable)
- `display_order`: Sort order within album
- `is_featured`: Featured photo flag
- `created_at`, `updated_at`: Timestamps

**Relationship**: `belongsTo(Album::class)` and `hasMany(Product::class)`

#### products
E-shop items (prints, digital downloads, etc.)
- `id`: Primary key
- `photo_id`: Foreign key to photos (nullable, null on delete)
- `name`: Product name
- `description`: Product description (nullable)
- `slug`: URL-friendly identifier (unique)
- `type`: Product type (e.g., 'print', 'digital', 'frame')
- `price`: Product price (decimal 10,2)
- `stock`: Available quantity
- `image`: Product image path (nullable)
- `is_available`: Availability toggle
- `created_at`, `updated_at`: Timestamps

**Relationship**: `belongsTo(Photo::class)`

### E-shop Tables

#### cart_items
Session-based shopping cart
- `id`: Primary key
- `session_id`: Session identifier (indexed)
- `product_id`: Foreign key to products (cascades on delete)
- `quantity`: Item quantity
- `price`: Price at time of adding to cart
- `created_at`, `updated_at`: Timestamps

#### orders
Customer orders
- `id`: Primary key
- `order_number`: Unique order identifier
- `customer_name`, `customer_email`, `customer_phone`: Customer info
- `shipping_address`, `city`, `postal_code`, `country`: Shipping details
- `subtotal`: Order subtotal before shipping
- `shipping_cost`: Shipping fee
- `total`: Total order amount
- `status`: Order status ('pending', 'processing', 'completed', 'cancelled')
- `notes`: Additional notes (nullable)
- `created_at`, `updated_at`: Timestamps

**Relationship**: `hasMany(OrderItem::class)`

#### order_items
Products in orders
- `id`: Primary key
- `order_id`: Foreign key to orders (cascades on delete)
- `product_id`: Foreign key to products
- `product_name`: Product name snapshot
- `quantity`: Ordered quantity
- `unit_price`: Price per unit
- `total_price`: Line item total
- `created_at`, `updated_at`: Timestamps

**Relationship**: `belongsTo(Order::class)` and `belongsTo(Product::class)`

## Development Commands

### Initial Setup
```bash
# Install PHP dependencies
composer install

# Install JavaScript dependencies
npm install --legacy-peer-deps

# Copy environment file and generate key
cp .env.example .env
php artisan key:generate

# Run migrations
php artisan migrate

# Build assets
npm run build
```

### Development Server
```bash
# Start Laravel development server
php artisan serve

# Start Vite dev server (in separate terminal)
npm run dev
```

Access the application at `http://localhost:8000`

### Database Management
```bash
# Run migrations
php artisan migrate

# Fresh migration (drops all tables)
php artisan migrate:fresh

# Rollback last migration
php artisan migrate:rollback

# Seed database (when seeders are created)
php artisan db:seed
```

### Code Quality
```bash
# Run tests
php artisan test

# Format code with Laravel Pint
./vendor/bin/pint

# Build assets for production
npm run build
```

### Creating New Components

#### Controller
```bash
php artisan make:controller PhotoController
```

#### Model with Migration
```bash
php artisan make:model Album -m
```

#### Vue Component
Create in `resources/js/Components/` or `resources/js/Pages/` depending on scope.

## Image Storage Configuration

The application stores uploaded images using Laravel's filesystem:

**Configuration**: `config/filesystems.php`

**Default disk**: `public` (symlinked to `storage/app/public`)

**Create symlink**:
```bash
php artisan storage:link
```

**Recommended image paths**:
- `storage/app/public/photos/` - Original photos
- `storage/app/public/photos/thumbnails/` - Thumbnail versions
- `storage/app/public/photos/medium/` - Medium-size versions
- `storage/app/public/products/` - Product images

**Access images**: `asset('storage/photos/image.jpg')`

## Inertia.js Patterns

### Controller Example
```php
use Inertia\Inertia;

public function index()
{
    return Inertia::render('Photos/Index', [
        'photos' => Photo::with('album')->latest()->paginate(12),
    ]);
}
```

### Vue Page Component Example
```vue
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';

defineProps({
    photos: Object,
});
</script>

<template>
    <AuthenticatedLayout>
        <div v-for="photo in photos.data" :key="photo.id">
            <!-- Photo content -->
        </div>
    </AuthenticatedLayout>
</template>
```

### Form Submission with Inertia
```vue
<script setup>
import { useForm } from '@inertiajs/vue3';

const form = useForm({
    title: '',
    description: '',
});

const submit = () => {
    form.post(route('photos.store'));
};
</script>
```

## Routing

**Define routes**: `routes/web.php`

**Use in Vue**:
```javascript
import { router } from '@inertiajs/vue3';

router.visit(route('photos.show', { photo: 1 }));
```

**Available via Ziggy**:
```javascript
route('photos.index')
route('photos.show', { photo: photoId })
```

## Authentication

Laravel Breeze is pre-configured with Inertia + Vue stack:
- Login, registration, password reset flows included
- Protected routes use `auth` middleware
- Guest routes use `guest` middleware
- User model: `App\Models\User`

**Protect admin routes**:
```php
Route::middleware(['auth'])->group(function () {
    Route::resource('photos', PhotoController::class);
});
```

## Tailwind CSS

Configured in `tailwind.config.js`. Breeze includes common form components styled with Tailwind.

**Purge paths** are set to scan Vue components for used classes.

**Development**: Changes auto-reload with Vite HMR

**Production**: Run `npm run build` to generate optimized CSS

## Key Features to Implement

### Gallery Features
- Photo upload with multiple sizes (original, medium, thumbnail)
- Album management (CRUD operations)
- Image lazy loading for performance
- Lightbox viewer for full-screen photo viewing
- Photo filtering by album

### E-shop Features
- Product catalog linked to photos
- Session-based shopping cart
- Checkout process collecting customer/shipping info
- Order management (admin view orders, update status)
- Basic order confirmation emails

### Admin Panel
- Dashboard with statistics
- Photo/Album CRUD interfaces
- Product management
- Order management (view, update status)
- Should be protected behind authentication

## Testing

**Run tests**:
```bash
php artisan test
```

**Create test**:
```bash
php artisan make:test PhotoTest
```

**Vue component testing**: Set up Vitest if needed for frontend testing

## Deployment Checklist

1. Set `APP_ENV=production` in `.env`
2. Set `APP_DEBUG=false`
3. Run `composer install --optimize-autoloader --no-dev`
4. Run `php artisan config:cache`
5. Run `php artisan route:cache`
6. Run `php artisan view:cache`
7. Run `npm run build`
8. Set up proper database (MySQL/PostgreSQL)
9. Configure web server (Nginx/Apache) to point to `public/`
10. Set up SSL certificate
11. Configure email settings for order notifications

## Environment Variables

Key variables in `.env`:
- `APP_URL` - Application URL
- `DB_CONNECTION` - Database driver
- `DB_DATABASE` - Database name/path
- `MAIL_*` - Email configuration for notifications
- `FILESYSTEM_DISK` - Storage disk (local, s3, etc.)

## Notes

- **Order items store product name**: This prevents issues if product names change after order placement
- **Cart uses session_id**: Allows anonymous shopping; can be linked to user accounts later
- **Photo sizes**: Generate multiple sizes on upload for optimal performance
- **Slug fields**: Use for SEO-friendly URLs; generate automatically from titles
- **Foreign key constraints**: Set up with cascade/null on delete for data integrity
